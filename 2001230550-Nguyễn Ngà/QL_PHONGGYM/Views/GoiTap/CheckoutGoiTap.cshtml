@model QL_PHONGGYM.Models.GoiTap

@{
    ViewBag.Title = "ThanhToan";
    Layout = "~/Views/Shared/_LayoutPageCart.cshtml";
    var giamGia = Model.Gia * @ViewBag.LoaiKh.MucGiam / 100;
    var thanhTien = Model.Gia - giamGia;
}
<style>
    select:focus,
    input[type="text"]:focus,
    input[type="email"]:focus {
        outline: none;
        border-color: #0dcaf0 !important;
    }

    select:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .payment-option {
        cursor: pointer;
        transition: all 0.2s ease;
    }

        .payment-option:hover {
            background-color: #f8f9fa;
        }

        .payment-option input[type="radio"]:checked ~ label {
            font-weight: 600;
        }

    .modal.show {
        animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content {
        animation: slideDown 0.3s ease-out;
    }
  
</style>

@if (Model == null || ViewBag.KhachHang == null)
{
    <div class="alert alert-danger text-center mt-5">
        <h4>Không tìm thấy thông tin!</h4>
        <a href="@Url.Action("Index", "Home")" class="btn btn-primary mt-3">Quay về trang chủ</a>
    </div>
    return;
}

<form id="goiTapForm" action="@Url.Action("TaoHoaDonGoiTap", "GoiTap")" method="post">
    @Html.AntiForgeryToken()
    <input name="giamGia" value="@giamGia" hidden />
    <input name="tongTien" value="@Model.Gia" hidden />
    <input name="thanhTien" value="@thanhTien" hidden />

    <div class="mt-2 d-flex flex-column mx-auto justify-content-center px-5" style="margin-top: 200px; margin-bottom: 300px; width: 40rem">
        <div class="py-3 position-relative border-bottom border-1">
            <a href="@ViewBag.Url" class="text-decoration-none position-absolute">
                <img src="@Url.Content("~/Content/Images/back.png")" style="width: 1.6rem; left: 3rem" alt="Back" />
            </a>
            <div class="w-100 text-center">
                <span class="fs-5 fw-bold text-black">Thanh toán gói tập</span>
            </div>
        </div>

        <div class="mt-4">
            <span class="text-uppercase fw-bold">Thông tin gói tập</span>
            <div class="bg-white border-1 rounded-3 border mt-2 p-3">
                <div class="d-flex justify-content-between p-0 mb-3">
                    <span class="fs-6 text-muted">Tên gói</span>
                    <span class="fs-6 fw-bold">@Model.TenGoi</span>
                </div>
                <div class="d-flex justify-content-between p-0 mb-3">
                    <span class="fs-6 text-muted">Thời hạn</span>
                    <span class="fs-6">@Model.ThoiHan tháng</span>
                </div>
                @if (!string.IsNullOrEmpty(Model.MoTa))
                {
                    <div class="mt-3 pt-3 border-top">
                        <span class="fs-6 text-muted d-block mb-2">Mô tả</span>
                        <p class="fs-6 mb-0">@Model.MoTa</p>
                    </div>
                }
                <div class="d-flex justify-content-between mt-3 py-3 border-top border-bottom border-1 border-secondary">
                    <span class="fs-6 text-muted">Giảm giá trực tiếp</span>

                    <span class="fs-6 text-danger">- @giamGia.ToString("N0")đ</span>
                </div>
                <div class="d-flex justify-content-between mt-3 py-3">
                    <span class="fs-6 fw-bolder">Tổng tiền</span>

                    <span class="fs-6 fw-bolder">@Model.Gia.ToString("N0")đ</span>
                </div>
                <div class="mt-3">
                    <small class="text-muted">
                        <i class="bi bi-info-circle me-1"></i>
                        Gói tập sẽ được kích hoạt ngay sau khi thanh toán thành công
                    </small>
                </div>
            </div>
        </div>


        <div class="mt-4">
            <span class="text-uppercase fw-bold">Phương thức thanh toán</span>
            <div class="bg-white mt-2">             
                <div class="payment-option p-3 border rounded-3">
                    <div class="d-flex align-items-center gap-3">
                        <input class="form-check-input" type="radio" name="paymentMethod" id="bankTransfer" value="BANK">
                        <label class="form-check-label flex-grow-1" for="bankTransfer" style="cursor: pointer;">
                            <div class="d-flex align-items-center justify-content-between">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="bg-light rounded-2 p-2 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-qr-code" viewBox="0 0 16 16">
                                            <path d="M2 2h2v2H2z" />
                                            <path d="M6 0v6H0V0zM5 1H1v4h4zM4 12H2v2h2z" />
                                            <path d="M6 10v6H0v-6zm-5 1v4h4v-4zm11-9h2v2h-2z" />
                                            <path d="M10 0v6h6V0zm5 1v4h-4V1zM8 1V0h1v2H8v2H7V1zm0 5V4h1v2zM6 8V7h1V6h1v2h1V7h5v1h-4v1H7V8zm0 0v1H2V8H1v1H0V7h3v1zm10 1h-1V7h1zm-1 0h-1v2h2v-1h-1zm-4 0h2v1h-1v1h-1zm2 3v-1h-1v1h-1v1H9v1h3v-2zm0 0h3v1h-2v1h-1zm-4-1v1h1v-2H7v1z" />
                                            <path d="M7 12h1v3h4v1H7zm9 2v2h-3v-1h2v-1z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <div class="fw-bold">Chuyển khoản ngân hàng</div>
                                        <small class="text-muted">Quét mã QR để thanh toán</small>
                                    </div>
                                </div>
                                <i class="bi bi-chevron-right text-muted"></i>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <span class="text-uppercase fw-bold">Thông tin khách hàng</span>
            <div class="bg-white border-1 rounded-3 border mt-2 p-3">
                <div class="d-flex justify-content-between p-0 mb-3">
                    <span class="fs-6 text-muted">Họ tên</span>
                    <div class="d-flex align-items-center gap-2">
                        @if (ViewBag.KhachHang.MaLoaiKH != null)
                        {
                            <div class="border-1 border border-primary rounded-2 p-1 small text-primary">@ViewBag.LoaiKh.TenLoai</div>
                        }
                        <span class="fs-6 fw-bold">@ViewBag.KhachHang.TenKH</span>
                    </div>
                </div>
                <div class="d-flex justify-content-between p-0 mb-3">
                    <span class="fs-6 text-muted">Số điện thoại</span>
                    <span class="fs-6">@ViewBag.KhachHang.SDT</span>
                </div>
                <div class="d-flex justify-content-between p-0">
                    <span class="fs-6 text-muted">Email</span>
                    <span class="fs-6">@ViewBag.KhachHang.Email</span>
                </div>
            </div>
        </div>

        <div class="mt-4">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                <label class="form-check-label text-muted small" for="agreeTerms">
                    Tôi đã đọc và đồng ý với
                    <a href="#" class="text-decoration-none">điều khoản sử dụng</a>
                    và
                    <a href="#" class="text-decoration-none">chính sách bảo mật</a>
                </label>
            </div>
        </div>
    </div>

    <div class="mt-5 mx-auto px-5 fixed-bottom rounded-3" style="margin-top: 200px; width: 40rem">
        <div class="d-flex w-100 bg-light px-2 py-2 flex-column border-top shadow-sm">
            <div class="d-flex justify-content-between mb-2">
                <span class="fw-bolder fs-6">Tổng thanh toán: </span>
                <span class="text-info fw-bolder fs-5">@thanhTien.ToString("N0")đ</span>
            </div>
            <div class="py-2 w-100">
                <button type="submit" class="btn btn-primary text-white text-center w-100 py-2">
                    <i class="bi bi-check-circle me-2"></i>Xác nhận đăng ký
                </button>
            </div>
        </div>
    </div>
</form>

@if (TempData["Message"] != null)
{
    <div class="modal fade show" id="warningModal" tabindex="-1" style="display: block; background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-header bg-warning bg-opacity-10 border-0">
                    <div class="d-flex align-items-center gap-2">
                        <div class="bg-warning bg-opacity-25 rounded-circle p-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill text-warning" viewBox="0 0 16 16">
                                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2" />
                            </svg>
                        </div>
                        <h5 class="modal-title fw-bold mb-0 text-warning">Thông báo quan trọng</h5>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" onclick="document.getElementById('warningModal').style.display='none'"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="mb-3 fs-6 text-dark">@TempData["Message"]</p>
                    <div class="alert alert-info border-0 bg-info bg-opacity-10 mb-0">
                        <div class="d-flex align-items-start gap-2">
                            <i class="bi bi-info-circle-fill text-info mt-1"></i>
                            <small class="text-muted">
                                Nếu bạn tiếp tục đăng ký, thời hạn mới sẽ được cộng dồn vào gói tập hiện tại của bạn.
                            </small>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0 bg-light">
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='@ViewBag.Url'">
                        <i class="bi bi-arrow-left me-2"></i>Quay lại
                    </button>
                    <button type="button" class="btn btn-primary" onclick="document.getElementById('warningModal').style.display='none'">
                        <i class="bi bi-check-circle me-2"></i>Tiếp tục đăng ký
                    </button>
                </div>
            </div>
        </div>
    </div>
}
